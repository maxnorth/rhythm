// Workflow DSL Feature Showcase
// Demonstrates all the modern syntax features
workflow(ctx, inputs) {
    // Variables and unquoted keys
    let userId = await Task.run("authenticate", {
                    username: "alice@example.com",
                    method: "oauth2"
                  })
  
  // Hex numbers for colors and configuration
  let themeConfig = await Task.run("load_theme", {
    primaryColor: 0xFF5733,      // Hex for colors
    secondaryColor: 0x3498DB,
    accentColor: 0x2ECC71,
    darkMode: true
  })
  
  // Binary numbers for bit flags and permissions
  let permissions = await Task.run("get_permissions", {
    userId: userId,
    flags: 0b1111,               // All permissions
    readMask: 0b0001,
    writeMask: 0b0010,
    executeMask: 0b0100,
    adminMask: 0b1000
  })
  
  // Numbers with underscores for readability
  let orderData = await Task.run("create_order", {
    userId: userId,
    items: [
      { sku: "PROD-001", qty: 2, price: 19.99 },
      { sku: "PROD-042", qty: 1, price: 1_299.99 }  // Underscore for readability
    ],
    subtotal: 1_339.97,
    tax: 133.99,
    total: 1_473.96,
    rewardPoints: 147_396       // Large numbers are clearer
  })
  
  // Flexible decimal notation
  let calculations = await Task.run("calculate_discount", {
    baseRate: .15,               // 15% (same as 0.15)
    bonusRate: .05,              // 5% bonus
    maxDiscount: 250.,           // Max $250 (same as 250.0)
    minPurchase: -.01            // Negative for edge case testing
  })
  
  // Scientific notation for very large/small numbers
  let scientificData = await Task.run("process_metrics", {
    pageViews: 1.5e6,            // 1.5 million
    conversionRate: 3.5e-2,      // 0.035 (3.5%)
    revenue: 2.5E5,              // $250,000
    avgResponseTime: 1.2e-3      // 1.2 milliseconds
  })
  
  // Fire-and-forget analytics (no await)
  Task.run("track_order_created", {
    orderId: orderData,
    userId: userId,
    eventType: "purchase",
    flags: 0x0001,               // Event flag
    timestamp: 1_234_567_890
  })
  
  // Nested objects with mixed key styles
  let shipmentId = await Task.run("create_shipment", {
    "order-id": orderData,       // Quoted key with dash
    recipient: {
      userId: userId,
      address: {
        street: "123 Main St",
        city: "San Francisco",
        zip: "94105",
        coordinates: {
          lat: 37.7749,
          lng: -122.4194
        }
      }
    },
    carrier: "USPS",
    service: "priority",
    trackingEnabled: true
  })
  
  // Escape sequences in strings
  await Task.run("send_notification", {
    userId: userId,
    subject: "Order Confirmation",
    body: "Thank you for your order!\n\nOrder ID: #12345\n\tTotal: $1,473.96\n\nTrack your package:\nC:\\tracking\\12345",
    html: "He said \"Check your email\" for updates"
  })
  
  // Arrays with variables
  let taskIds = await Task.run("queue_tasks", {
    tasks: [
      orderData,
      shipmentId,
      userId
    ],
    priorities: [1, 2, 3],
    config: {
      concurrent: 3,
      retries: 5,
      timeout: 30_000            // 30 seconds in milliseconds
    }
  })
  
  // Unicode support
  await Task.run("üòé", {
    msg: "‰ªªÂä°ÂÆåÊàê",              // "Task complete" in Chinese
    emoji: "üéâ",
    status: "success"
  })
  
  // Complex nested structure showcasing everything
  await Task.run("finalize_order", {
    orderId: orderData,
    userId: userId,
    shipmentId: shipmentId,
    metadata: {
      processingTime: 1.23e3,    // 1,230 ms
      flags: 0b11111111,         // All flags set
      colorScheme: 0xFFFFFF,     // White
      priority: .95,             // 95% priority
      resources: {
        memory: 512_000_000,     // 512 MB
        cpu: .75,                // 75% CPU
        network: 1_000_000       // 1 Mbps
      }
    },
    tracking: {
      events: [],
      status: "completed",
      "final-check": true
    }
  })
}
