// Conditional payment processing workflow
// Demonstrates if/else logic with different payment amounts and statuses

workflow(ctx, inputs) {
  // Check payment amount and choose processing path
  if (inputs.amount > 1000) {
    // High-value payment - requires additional verification
    await Task.run("verify_identity", { userId: inputs.userId })
    await Task.run("fraud_check", { amount: inputs.amount })
    let paymentResult = await Task.run("process_premium_payment", {
      userId: inputs.userId,
      amount: inputs.amount
    })
  } else {
    // Standard payment processing
    let paymentResult = await Task.run("process_standard_payment", {
      userId: inputs.userId,
      amount: inputs.amount
    })
  }

  // Check payment result status
  if (paymentResult.status == "success") {
    await Task.run("send_receipt", {
      userId: inputs.userId,
      transactionId: paymentResult.transactionId
    })
    await Task.run("update_account", {
      userId: inputs.userId,
      amount: inputs.amount
    })
  } else {
    await Task.run("send_failure_notification", {
      userId: inputs.userId,
      reason: paymentResult.error
    })
  }

  // Analytics - fire and forget
  Task.run("track_payment_event", {
    userId: inputs.userId,
    amount: inputs.amount,
    status: paymentResult.status
  })
}
